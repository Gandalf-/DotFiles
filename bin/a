#!/bin/bash

# shellcheck disable=SC1090

root="$(dirname "${BASH_SOURCE[0]}")"/..
source "${root}/lib/common.sh"

wizard_assistant() {

  common::optional-help "$1" "

  provide some commands that might be useful to run based on the current
  context
  "

  local selection
  selection="$(assistant | fzf --cycle --multi --height=10 --print-query)"

  [[ $selection ]] || exit 0

  local first=1
  local other_elements_exist=0
  local query=''

  while read -r command; do

    if (( first )); then
      common::debug "first is $command"
      query="$command"
      first=0
    else
      common::debug "other element is $command"
      other_elements_exist=1
    fi

  done <<< "$selection"

  if (( other_elements_exist )); then
    common::debug "other elements exist"

    while read -r command; do

      if [[ "$command" == "$query" ]]; then
        common::debug "skipping $query"
        continue
      fi

      common::debug "running $command"

      eval "$command"
    done <<< "$selection"

  else
    common::debug "no other elements"
    eval "$query"
  fi

  common::echo '---------------------------------------------'
  wizard_assistant "$@"
  return $#
}

wizard_assistant "$@"
