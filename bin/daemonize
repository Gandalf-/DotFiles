#!/bin/bash

name="$*"
name="${name// /}"

pidfile=/tmp/daemonizer-"$name".pid
logfile=/tmp/daemonizer-"$name".log

pid="$(cat "$pidfile" 2>/dev/null)"

if [[ "$pid" ]]; then
  if kill -0 "$pid"; then
    # already running, pidfile accurate
    exit 0
  fi

  # stale pidfile
  rm "$pidfile"
fi

# daemonize
"$@" > "$logfile" 2> "$logfile" &

pid=$!
echo "$pid" > "$pidfile"

disown
