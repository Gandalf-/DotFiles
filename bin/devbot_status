#!/bin/bash

# does the same as wizard devbot status, but without the overhead. this is
# important because it's called every 5 seconds by each tmux window

pfile=~/.devbot/pid
lfile=~/.devbot/log

if [[ -e $pfile ]]; then
  read -r pid < $pfile

  if kill -0 "$pid" && [[ "$(ps -p "$pid" -o comm=)" == "wizard" ]]; then
    echo "✓"

  else
    echo "detected stale pid file" >> "$lfile"
    rm "$pfile"
    wizard devbot start
  fi

else
  echo "✗"
fi
