#!/bin/bash

dry=0
case "$1" in
  '-i') dry=1
    ;;

  '-h'|'--help')
    echo "
  cleanup [-i]
    smart remove duplicate file names and intermediary file types
    "
    ;;
esac

counter=0
while read -r file; do
  fixed="$(sed -e 's/[ ]*([0-9]\+)//' <<< "$file")"

  # make sure the file still exists
  if [[ -e "$file" ]] ; then

    if [[ -f "$fixed" ]]; then
      echo "remove dup: $file"
      (( dry )) || rm "$file" || exit

    else
      echo "rename dup: $file"
      (( dry )) || mv "$file" "$fixed" || exit
    fi

    let counter++
  fi
done < <(find -regex '.*([0-9]+).*')

while read -r file; do
  echo "remove    : $file"
  (( dry )) || rm "$file" || exit
  let counter++
done < <(find -regex '.*\.\(pyc\|class\|o\|bak\)')

echo "Cleaned up $counter files"
